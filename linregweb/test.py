__author__ = "Kuvykin Nikita"


from model_unit import predict
from module_download import load_model
import numpy as np
import pytest 


try:
    train_model = load_model()
    print("Модель загружена")
except Exception as e:
    raise pytest.UsageError(f"Ошибка загрузки модели: {e}")


# Тестовые данные и ожидаемые результаты
test_data = [
    ([-1.371047, -1.033614, -0.315653, 0.607639], 1.90315613, "Тест 1"),
    ([1.027208, 0.770518, 0.688083, -0.053609], 30.47227318, "Тест 2"),
    ([-0.1996862017274523, 0.4174857898871989, 1.9131565574388292, 0.34618465051932246], 20.90844094, "Тест 3"),
    ([-1.1554793563131376, -0.8604470595817343, 0.16250335545793504, -0.8040226132834724], -105.65813632, "Тест 4"),
    ([0.28208759452617493, 0.42088342652514804, 0.8532918772325484, -0.2938139669205567], -14.71153454, "Тест 5"),
    ([-0.6036199760572349, 1.3203227067759158, 0.8273602627900478, 0.8846356875619851], 50.53462767, "Тест 6"),
    ([1.1650070019404162, 2.1944579377316202, -0.8235373178534059, -0.14825603746176508], 27.05523011, "Тест 7"),
    ([1.2074320030700758, -0.5117090917911202, -0.9189932063136543, -0.9034080380090946], -32.41109455, "Тест 8"),
    ([-0.7735219111503354, 0.5089491275981249, 0.04887501541454854, 1.7238711341434834], 113.14950198, "Тест 9"),
    ([0.43395668318228364, -0.38426038004559426, 0.477260237725489, 0.29118207178718003], 38.32964301, "Тест 10")
]


# Параметризованные тесты
@pytest.mark.parametrize("features,expected,test_name", test_data)
def test_predictions(features, expected, test_name):
    """
    Тестирование предсказаний модели на различных наборах признаков
    """

    global train_model

    # Преобразуем в numpy array и делаем предсказание
    input_data = np.array([features])
    prediction = train_model.predict(input_data)

    prediction_value = prediction[0]
    
    # Сравниваем с ожидаемым значением с допуском 0.0001
    assert abs(prediction_value - expected) < 0.0001, f"{test_name}: ожидалось {expected}, получено {prediction_value}"

